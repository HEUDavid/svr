<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mdavid.cn</title>
</head>
<body>
<div class="area">
    <ul class="circles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</div>

<div class="footer">
    <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=23010302000239"
       target="_blank">黑公网安备 23010302000239号</a>
    <a href="https://beian.miit.gov.cn" target="_blank">苏ICP备17021154号-1</a>
</div>

<div class='list-container'>
    <h1>mdavid.cn</h1>
    <h2>Backtesting</h2>
    <ul class='list' id="fileList"></ul>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        async function fetchData() {
            try {
                const response = await fetch('/api/get_files');
                if (!response.ok) {
                    throw new Error(`Failed to fetch data. Status: ${response.status}`);
                }
                const files = await response.json();
                if (Object.keys(files).length === 0) {
                    console.warn('Fetch warning: The response object is empty.');
                    return;
                }
                handleFileList(files);
            } catch (error) {
                console.error('Fetch error:', error.message);
            }
        }

        function createFileListItem(file) {
            const li = document.createElement('li');

            const span = document.createElement('span');
            span.className = 'circle';
            li.appendChild(span);

            const link = document.createElement('a');
            link.target = '_blank';
            link.href = `/data/${file.name}`;

            const date = new Date(file.mtime * 1000);
            const formattedDate = new Intl.DateTimeFormat(undefined, {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                // second: '2-digit',
                hour12: false,
            }).format(date);
            link.textContent = `${formattedDate} ${file.name.replace('.html', '')}`;

            li.appendChild(link);
            return li;
        }

        function handleFileList(files) {
            const fileListElement = document.getElementById('fileList');
            files.forEach(file => {
                const li = createFileListItem(file);
                fileListElement.appendChild(li);
            });
        }

        fetchData();
    });
</script>
</body>
</html>
